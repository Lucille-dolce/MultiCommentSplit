<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëŒ“ê¸€ ë¶„í• ê¸° (400ì ì œí•œ)</title>
  <!-- Pretendard í°íŠ¸ (ìƒì—…ì  ë¬´ë£Œ ì›¹í°íŠ¸) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/static/pretendard.css">
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1em;
      resize: vertical;
      box-sizing: border-box;
    }
    .buttons {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    button {
      flex: 1;
      padding: 10px;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
      color: #333;
    }
    button:hover {
      filter: brightness(95%);
    }
    /* íŒŒìŠ¤í…” ì»¬ëŸ¬ */
    .split-btn {
      background-color: #FFE082; /* ë°ì€ íŒŒìŠ¤í…” ì˜¤ë Œì§€ */
    }
    .download-csv {
      background-color: #FFCCBC; /* ë°ì€ íŒŒìŠ¤í…” ì‚´êµ¬ */
    }
    .download-txt {
      background-color: #F8BBD0; /* ë°ì€ íŒŒìŠ¤í…” í•‘í¬ */
    }
    .download-zip {
      background-color: #C8E6C9; /* ë°ì€ íŒŒìŠ¤í…” ê·¸ë¦° */
    }
    .copy-clipboard {
      background-color: #E1BEE7; /* ë°ì€ íŒŒìŠ¤í…” í¼í”Œ */
    }
    
    .result {
      margin-top: 20px;
    }
    .result-count {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    /* ë¶„í• ëœ í…ìŠ¤íŠ¸ì˜ ê° ë¸”ë¡ */
    .segment {
      position: relative;          /* ë³µì‚¬ ë²„íŠ¼ì„ ìš°ì¸¡ ìƒë‹¨ì— ë°°ì¹˜í•˜ê¸° ìœ„í•¨ */
      margin-bottom: 15px;        
      padding: 15px 45px 15px 15px; /* ì˜¤ë¥¸ìª½ ê³µê°„ì„ ì¢€ ë” í™•ë³´ */
      border: 1px solid #eee;
      border-radius: 10px;
      background: #f9f9f9;
      word-break: break-all;
    }
    /* ë¶„í•  ë²ˆí˜¸ */
    .segment-index {
      font-weight: bold;
      color: #666;
      margin-bottom: 5px;
    }
    /* ì‹¤ì œ í…ìŠ¤íŠ¸ */
    .segment-text {
      margin-top: 5px;
      line-height: 1.5;
    }
    /* ê°œë³„ ë³µì‚¬ ë²„íŠ¼ */
    .segment-copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      border: none;
      background: none;
      color: #999;
      font-size: 1.2em;
      cursor: pointer;
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.3s, transform 0.2s;
    }
    .segment-copy-btn:hover {
      color: #333;
      transform: scale(1.1);
    }
    
    @media (max-width: 600px) {
      .buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ëŒ“ê¸€ ë¶„í• ê¸° ğŸ“</h1>
    <textarea id="inputText" placeholder="ì—¬ê¸°ì— ê¸´ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
    <div class="buttons">
      <button class="split-btn" id="splitButton">ë¶„í•  ì‹œì‘ ğŸš€</button>
      <button class="download-csv" id="downloadCsv">CSV ë‹¤ìš´ë¡œë“œ ğŸ“¥</button>
      <button class="download-txt" id="downloadTxt">TXT ë‹¤ìš´ë¡œë“œ ğŸ“„</button>
      <button class="download-zip" id="downloadZip">ZIP ë‹¤ìš´ë¡œë“œ ğŸ“¦</button>
      <button class="copy-clipboard" id="copyClipboard">í´ë¦½ë³´ë“œ ë³µì‚¬ ğŸ“‹</button>
    </div>
    <div class="result" id="resultArea"></div>
  </div>
  
  <!-- JSZip ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  
  <script>
    const MAX_CHARS = 400;
    
    // ì…ë ¥ëœ í…ìŠ¤íŠ¸ë¥¼ ì–´ì ˆ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ 400ì ì œí•œì— ë§ê²Œ ë¶„í• 
    function splitText(text) {
      let segments = [];
      let words = text.split(/\s+/);
      let currentSegment = "";
      
      for (let word of words) {
        // ë‹¤ìŒ ë‹¨ì–´ë¥¼ ì¶”ê°€í–ˆì„ ë•Œ 400ìë¥¼ ì´ˆê³¼í•˜ë©´ ë¶„í• 
        if ((currentSegment + (currentSegment ? " " : "") + word).length > MAX_CHARS) {
          // í˜„ì¬ ì„¸ê·¸ë¨¼íŠ¸ê°€ ë¹„ì–´ìˆë‹¤ë©´(ë‹¨ì–´ ìì²´ê°€ ë„ˆë¬´ ê¸´ ê²½ìš°) ê°•ì œë¡œ 400ìì”© ë¶„í• 
          if (!currentSegment) {
            let start = 0;
            while(start < word.length) {
              segments.push(word.slice(start, start + MAX_CHARS));
              start += MAX_CHARS;
            }
          } else {
            segments.push(currentSegment);
            currentSegment = word;
          }
        } else {
          currentSegment += (currentSegment ? " " : "") + word;
        }
      }
      if (currentSegment) {
        segments.push(currentSegment);
      }
      return segments;
    }
    
    // ë¶„í• ëœ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ í™”ë©´ì— í‘œì‹œ
    function displaySegments(segments) {
      const resultArea = document.getElementById('resultArea');
      resultArea.innerHTML = "";
      
      // ë¶„í•  ê°œìˆ˜ í‘œì‹œ
      const countElem = document.createElement('div');
      countElem.className = "result-count";
      countElem.textContent = `ë¶„í• ëœ ëŒ“ê¸€ ê°œìˆ˜: ${segments.length}`;
      resultArea.appendChild(countElem);
      
      // ê° ì„¸ê·¸ë¨¼íŠ¸ë¥¼ UIë¡œ ìƒì„±
      segments.forEach((segment, index) => {
        const segElem = document.createElement('div');
        segElem.className = "segment";
        
        const segIndex = document.createElement('div');
        segIndex.className = "segment-index";
        segIndex.textContent = `#${index + 1}`;
        
        const segText = document.createElement('div');
        segText.className = "segment-text";
        segText.textContent = segment;
        
        // ê°œë³„ ë³µì‚¬ ë²„íŠ¼
        const copyBtn = document.createElement('button');
        copyBtn.className = "segment-copy-btn";
        copyBtn.innerText = "ğŸ“‹";
        copyBtn.title = "ì´ í…ìŠ¤íŠ¸ë§Œ ë³µì‚¬";
        copyBtn.addEventListener('click', () => {
          navigator.clipboard.writeText(segment)
            .then(() => alert("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"))
            .catch(err => alert("ë³µì‚¬ ì‹¤íŒ¨: " + err));
        });
        
        segElem.appendChild(segIndex);
        segElem.appendChild(segText);
        segElem.appendChild(copyBtn);
        
        resultArea.appendChild(segElem);
      });
    }
    
    // CSV ë‹¤ìš´ë¡œë“œ
    function downloadCSV(segments) {
      let csvContent = segments.map((seg, i) => `"Segment ${i+1}","${seg.replace(/"/g, '""')}"`).join("\n");
      let blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      let url = URL.createObjectURL(blob);
      let a = document.createElement('a');
      a.href = url;
      a.download = `segments_${new Date().toISOString()}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // TXT ë‹¤ìš´ë¡œë“œ
    function downloadTextFile(segments) {
      let textContent = segments.join("\n\n");
      let blob = new Blob([textContent], { type: 'text/plain;charset=utf-8;' });
      let url = URL.createObjectURL(blob);
      let a = document.createElement('a');
      a.href = url;
      a.download = `segments_${new Date().toISOString()}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // ZIP ë‹¤ìš´ë¡œë“œ (JSZip í™œìš©)
    function downloadZip(segments) {
      const zip = new JSZip();
      const folderName = `segments_${new Date().toISOString()}`;
      const folder = zip.folder(folderName);
      
      segments.forEach((seg, index) => {
        folder.file(`segment_${index+1}.txt`, seg);
      });
      
      zip.generateAsync({type:"blob"}).then(function(content) {
        let a = document.createElement('a');
        a.href = URL.createObjectURL(content);
        a.download = `${folderName}.zip`;
        a.click();
        URL.revokeObjectURL(a.href);
      });
    }
    
    // ì „ì²´ í…ìŠ¤íŠ¸ í´ë¦½ë³´ë“œ ë³µì‚¬
    function copyToClipboard(segments) {
      const textToCopy = segments.join("\n\n");
      navigator.clipboard.writeText(textToCopy)
        .then(() => alert("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"))
        .catch(err => alert("ë³µì‚¬ ì‹¤íŒ¨: " + err));
    }
    
    // ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('splitButton').addEventListener('click', () => {
      const inputText = document.getElementById('inputText').value.trim();
      if (!inputText) {
        alert("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const segments = splitText(inputText);
      displaySegments(segments);
    });
    
    document.getElementById('downloadCsv').addEventListener('click', () => {
      const inputText = document.getElementById('inputText').value.trim();
      if (!inputText) {
        alert("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const segments = splitText(inputText);
      downloadCSV(segments);
    });
    
    document.getElementById('downloadTxt').addEventListener('click', () => {
      const inputText = document.getElementById('inputText').value.trim();
      if (!inputText) {
        alert("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const segments = splitText(inputText);
      downloadTextFile(segments);
    });
    
    document.getElementById('downloadZip').addEventListener('click', () => {
      const inputText = document.getElementById('inputText').value.trim();
      if (!inputText) {
        alert("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const segments = splitText(inputText);
      downloadZip(segments);
    });
    
    document.getElementById('copyClipboard').addEventListener('click', () => {
      const inputText = document.getElementById('inputText').value.trim();
      if (!inputText) {
        alert("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const segments = splitText(inputText);
      copyToClipboard(segments);
    });
  </script>
</body>
</html>
